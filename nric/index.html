<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NRIC Generator/Validator</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-3325476-169"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-3325476-169');
</script>
</head>
<body>
<h1>NRIC Generator/Validator</h1>
<p><input type="text" name="nric" id="nric"> <span style="padding-left:10px" id="result"></span></p>
<p><button onclick="validateNRIC()">Validate</button> <button onclick="generateNRIC()">Generate</button></p>

<script>
function validateNRIC() {
    var nric = document.getElementById("nric").value.toUpperCase();
    var digits = nric.slice(1, 8);
    var sum = 0;
    var weights = [2, 7, 6, 5, 4, 3, 2];
    var stCheck = 'JZIHGFEDCBA';
    var fgCheck = 'XWUTRQPNMLK';
    var valid = false;
    if (nric.length !== 9 || !['S', 'T', 'G', 'F'].includes(nric[0])) valid = false;
    if (isNaN(digits)) valid = false;
    if (['T', 'G'].includes(nric[0])) sum += 4;
    for (var i = 0; i < digits.length; i++) sum += parseInt(digits.charAt(i), 10) * weights[i];
    if (['S', 'T'].includes(nric[0])) valid = (stCheck.charAt(sum % 11) === nric[8]);
    if (['F', 'G'].includes(nric[0])) valid = (fgCheck.charAt(sum % 11) === nric[8]);
    document.getElementById("result").innerHTML = valid;     
}

function generateNRIC() {
	var prefixes = ['S', 'T'];
	var prefix = prefixes[random(0,2)];
	var digits = random(1000000, 9999999).toString();
    var sum = 0;
    var weights = [2, 7, 6, 5, 4, 3, 2];	
    for (var i = 0; i < 7; i++) sum += digits[i] * weights[i];
    var checkdigit = sum % 11;
	if (prefix === 'S') { checkprefix = [ 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'Z', 'J' ]; }
	else if (prefix === 'T') { checkprefix = [ 'H', 'I', 'Z', 'J', 'A', 'B', 'C', 'D', 'E', 'F', 'G' ]; }    
	var suffix = checkprefix[10 - checkdigit];    	
	var nric = prefix + digits + suffix;
    document.getElementById("result").innerHTML = "true";	
	document.getElementById("nric").value = nric;
}

function random(min, max) {
	var min = Math.ceil(min);
	var max = Math.floor(max);
	return Math.floor(Math.random() * (max - min)) + min;
}
</script>

<p style="padding-top: 20px; font-size: x-small"><a href="/">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</a></p>
</body>
</html>